---
title: "Developer-instructions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Developer-instructions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(wqbench)
```

## Updating the Internal Data Set in the Shiny app

The shiny app is located in the [shinywqbench](https://github.com/bcgov/shinywqbench) repository. 
To update the internal data file

1. Go to the inst/extdata/data.R file.
2. Run the script.

This needs to occur each time the ECOTOX EPA data set is updated on the website.  

## How to Deploy the Shiny App

The shiny app is located in the [shinywqbench](https://github.com/bcgov/shinywqbench) repository.

1. Go to the scripts/deploy.R file.
2. Run the script.

It is advised to first run the code that deploys the app name of `shinywqbench-dev` and confirm the app deploys and functions as expected.
This app is referred to as the development app. 

Once it has been confirmed that the app functions and deploys properly to then run the second chunk of code with the app name `shinywqbench`.
This app is referred to as the production app. 

This will help to ensure the production app is always in a working state.

## Updating the Add Data Template

The instructions in the uploading data template need to up updated when any changes to the reference data sheets occur. 

- trophic-groups.csv
  - need to update trophic_group column and ecological_group column instructions if new groups are added or groups are removed
  - the groups have been manually added to the instruction tab
  - the validation is done off of the trophic-groups.csv so it is possible for the instructions to get out of sync with the allowed values
   
- lifestage-codes.csv
  - need to update simple_lifestage column instructions if new simple lifestages are added or removed 
  - the validation is done off of the lifestage-codes.csv so it is possible for the instructions to get out of sync with the allowed values
  
- concentration-endpoints.csv
  - need to update endpoint column instructions if endpoints are added or removed
  - the list of endpoints on the third sheet are generated using the function XXX, this needs to be run each time the concentration-endpoints.csv file is updated
  - the validation is done off of the concentration-endpoints.csv so it is possible for the instructions to get out of sync with the allowed values  
  
To regenerate the list of endpoints you will need to go to the *data-raw/template.R* file and run the script.
This will add the template section to the package and regenerate the list of allowed endpoint codes.

In the templates folder only the csv files should be updated manually.
The excel file is for people to use when filling in with their data and is generated from running the *data-raw/template.R* script.

## Updating Reference Data

### BC Species

This list should not vary or need to be reviewed often as it is not expected that the species in BC will vary from year to year.
This is a comprehensive list that was generated from B.C. Conservation Data Centre.

### Concentration Conversion

This data set should be reviewed each time a new pull from the ECOTOX data set is generated. 

### Concentration Endpoints

The list of concentration endpoints are generated in the *data-raw/concentration-endpoints.R* script. 

This is a comprehensive list that should not need to be adjusted unless a different set of endpoint codes allowed. 


### Lifestage Codes

This data set should be reviewed each time a new pull from the ECOTOX data set is generated. 


### Trophic Groups

This data set should be reviewed each time a new pull from the ECOTOX data set is generated. 

Run the script *scripts/review-trophic-groups.R* to generate two lists for review.
This generates two files

1. Raw species data from the database, which can be helpful when things may be missed classified into the order or class. 
2. The current reference data joined to the filtered and cleaned class and order list in the database. 

Both of these files need to be reviewed and will guide any updates to the reference data for the trophic groups.
Update the file *inst/extdata/trophic-groups.csv* based on the review.
