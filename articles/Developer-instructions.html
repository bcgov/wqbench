<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Developer Instructions • wqbench</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Developer Instructions">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wqbench</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Developer-instructions.html">Developer Instructions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Developer Instructions</h1>
            
      

      <div class="hidden name"><code>Developer-instructions.Rmd</code></div>

    </div>

    
    
<!--
rmarkdown::html_vignette:
rmarkdown::github_document:

rmarkdown::render("vignettes/Developer-instructions.Rmd")
-->
<div class="section level2">
<h2 id="updating-reference-data-for-the-database">Updating Reference Data for the Database<a class="anchor" aria-label="anchor" href="#updating-reference-data-for-the-database"></a>
</h2>
<p>Each time the Ecotox database is updated, the reference files in the
package should be reviewed for necessary changes. This process involves
generating some files to illustrate changes, having those files reviewed
by an expert, and updated if necessary, and then updating the data files
in the package with the new changes.</p>
<p>These changes may involve:</p>
<ul>
<li>concentration conversions and duration conversions for newly-added
concentration and duration units,</li>
<li>trophic groups and life stage codes for newly added species.</li>
</ul>
<p>Lists of BC species and concentration endpoints are unlikely to
require changes but should be reviewed periodically.</p>
<div class="section level3">
<h3 id="process">Process<a class="anchor" aria-label="anchor" href="#process"></a>
</h3>
<ol start="0" style="list-style-type: decimal">
<li><p>Download (clone or pull) the <code>wqbench</code> repo and open
in RStudio. The best practice is to open a new git branch, called
something like <code>update-[date-of-new-ecotox]</code>. In Rstudio, git
pane -&gt; New branch -&gt; give it a name, and check “Sync branch with
remote”.</p></li>
<li><p>Ensure you have the most recent copy of the database with the
reference files added. To do this, load the package, and run the
function <code><a href="../reference/wqb_create_data_set.html">wqb_create_data_set()</a></code>:</p></li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/wqb_create_data_set.html">wqb_create_data_set</a></span><span class="op">(</span></span>
<span>  file_path <span class="op">=</span> <span class="st">"~/Ecotoxicology/ecotox"</span>,</span>
<span>  version <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  folder_path <span class="op">=</span> <span class="st">"~/Ecotoxicology/ecotox_db/"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Execute the code in the script
<em>scripts/review-reference-datasets-01.R</em>.</li>
</ol>
<ul>
<li>This script will generate and save a set of csv files that need to
be reviewed and updated to allow new values through the data cleaning
steps.</li>
<li>At the top of the script you will need to set the file path for the
database and the location to save the files that are generated. By
defeault they will save at:
<code>"~/Poisson/Data/wqbench/[current-year]/review/to-be-reviewed/"</code>
</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>After the files are generated, they need to be <a href="#review-process">reviewed and updated</a> by a technical
expert.</li>
</ol>
<ul>
<li>The next step must wait until the review is complete.</li>
<li>The life stage code file can’t be reviewed until after the trophic
groups have been updated.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Once the files are reviewed they should be placed in:
<code>"~/Poisson/Data/wqbench/[current-year]/review/completed/"</code>
</li>
</ol>
<ul>
<li>Then run the <em>scripts/update-reference-datasets-01.R</em>
script.</li>
<li>Run this line by line - You will be shown several displays showing
the updates that will be made to the internal data - ensure these look
ok. If they do, continue executing the script, if not you will need to
revisit your review and the changes you made to the csv files in the
<code>completed</code> folder.</li>
<li>This will read in the reviewed files and update the reference files
in the <em>inst/extdata</em> folder.</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li><p>The package needs to be re-built for the files to be part of the
package. Run <code>devtools::load_all()</code>.</p></li>
<li><p>Run the <code><a href="../reference/wqb_create_data_set.html">wqb_create_data_set()</a></code> function to create the
database with the new reference data.</p></li>
<li><p>Repeat steps 2 through 6 but run
<em>scripts/review-reference-datasets-02.R</em>, review the file, and
run <em>scripts/update-reference-datasets-02.R</em>.</p></li>
</ol>
<ul>
<li>The life stage codes have to be generated seperately as they are
based on the trophic groups. The trophic groups need to be updated
before life stage codes can be reviewed.</li>
</ul>
<ol start="8" style="list-style-type: decimal">
<li><p>Run the <code><a href="../reference/wqb_create_data_set.html">wqb_create_data_set()</a></code> function again to
create the database with the new reference data.</p></li>
<li><p>These steps will have caused changes to several files in
<code>inst/extdata</code>. The changes will be shown in the Git pane in
RStudio. Commit these files to Git, and push it to GitHub. Go to the
GitHub repository, and open a pull request from your branch (created in
step 1). Best practice is to have someone review the PR, but if you know
the changes are good, you can merge it yourself.</p></li>
<li><p>Once your update is merged, install the new version:
<code>devtools::install_github("bcgov/wqbench")</code>.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="review-process">Review process<a class="anchor" aria-label="anchor" href="#review-process"></a>
</h3>
<p>Below are instructions for how to fill out and complete each of the
reference files.</p>
<div class="section level4">
<h4 id="concentration-conversion">Concentration Conversion<a class="anchor" aria-label="anchor" href="#concentration-conversion"></a>
</h4>
<p>This data set should be reviewed each time a new version of the
ECOTOX database is released.</p>
<ul>
<li>If there is no value in the <strong>conc_conversion_flag</strong>
column this indicates it is a new concentration unit that was not in the
previous version of the database.</li>
<li>The goal of the review is to ensure all cells in the
<strong>conc_conversion_flag</strong> column are filled in.
<ul>
<li>A zero (<code>0</code>) indicates the concentration cannot be
converted to mg/L or ppm.
<ul>
<li>If the units cannot be converted to mg/L or ppm then put a
<code>0</code> in the row.</li>
<li>No additional columns need to be filled in if the unit is given a
value of <code>0</code> in the <strong>conc_conversion_flag</strong>
column.</li>
</ul>
</li>
<li>A one (<code>1</code>) indicates the concentration can be converted
to mg/L or ppm.
<ul>
<li>If the units can be converted put a <code>1</code> in the row.
<ul>
<li>In the <strong>conc_conversion_value_multiplier</strong> column fill
in the value needed to convert the units into mg/L or ppm.</li>
<li>In the <strong>conc_conversion_unit</strong> column fill in either
<code>mg/L</code> or <code>ppm</code>.</li>
</ul>
</li>
</ul>
</li>
<li>Once completed, this file should be saved in the
<code>"completed"</code> subfolder in the review folder.</li>
</ul>
</li>
</ul>
<p>If any incorrect conversions are found, then those rows can be
updated.</p>
</div>
<div class="section level4">
<h4 id="duration-conversion">Duration Conversion<a class="anchor" aria-label="anchor" href="#duration-conversion"></a>
</h4>
<p>This data set should be reviewed each time a new version of the
ECOTOX database is released.</p>
<ul>
<li>If there is no value in the <strong>duration_units_to_keep</strong>
column this indicates it is a new concentration unit that was not in the
previous version of the database.</li>
<li>The goal of the review is to ensure all cells in the
<strong>duration_units_to_keep</strong> column are filled in.
<ul>
<li>A zero (<code>0</code>) indicates the duration cannot be converted
to hours.
<ul>
<li>If the units cannot be converted to hours, then put a <code>0</code>
in the row.</li>
<li>No additional columns need to be filled in if the unit is given a
value of <code>0</code> in the <strong>duration_units_to_keep</strong>
column.</li>
</ul>
</li>
<li>A one (<code>1</code>) indicates the duration can be converted to
hours.
<ul>
<li>If the units can be converted put a <code>1</code> in the row.
<ul>
<li>In the <strong>duration_value_multiplier_to_hours</strong> column
fill in the value needed to convert the units into hours.</li>
<li>In the <strong>comments</strong> column write why the conversion was
chosen since there may be an assumption made during the conversion. For
example, if converting month into hours are you basing the conversion on
30 or 31 days.</li>
</ul>
</li>
</ul>
</li>
<li>Once completed, this file should be saved in the
<code>"completed"</code> subfolder in the review folder.</li>
</ul>
</li>
</ul>
<p>If any incorrect conversions are found, then those rows can be
updated.</p>
</div>
<div class="section level4">
<h4 id="trophic-groups">Trophic Groups<a class="anchor" aria-label="anchor" href="#trophic-groups"></a>
</h4>
<p>This data set should be reviewed each time a new version of the
ECOTOX database is released.</p>
<ul>
<li>Two files will be generated to help review the trophic group data.
<ul>
<li>
<em>missing-trophic-group-review.csv</em>
<ul>
<li>This is a summary that shows the unique phylum, class, order, and
family of new taxa in the new version of Ecotox database, that do not
meet the exclusion criteria. In other words, these are candidate taxa to
be added to the internal dataset.</li>
<li>This file contains three columns for the reviewer to consider:
<strong>trophic_group</strong>, <strong>ecological_group</strong>, and
<strong>exclude_from_db</strong>.
<ul>
<li>If the taxon is not appropriate for inclusion, put a <code>1</code>
in the <strong>exclude_from_db</strong> column. Otherwise leave it
blank.</li>
<li>If it is appropriate to include, fill out the
<strong>trophic_group</strong> and <strong>ecological_group</strong>
columns. Valid values for <strong>trophic_group</strong> are:
“Invertebrate”, “Algae”, “Amphibian”, “Plant”, “Bacteria”, “Fish”. Valid
values for <strong>ecological_group</strong> are: “Planktonic
Invertebrate”, “Other”, “Salmonid”.</li>
<li>If there is a row in the “missing-trophic-review” sheet that doesn’t
have family or order, do one of two things: if the phylum/division is
really small and the whole taxon can be assigned an ecological group and
trophic group, do so. If not (e.g. Annelida, Arthropoda), just leave it
blank - and rest assured that lower taxonomic entities have likely been
assigned to the appropriate trophic group and ecological group.</li>
</ul>
</li>
<li>Once completed, this file should be saved in the
<code>"completed"</code> subfolder in the review folder.</li>
</ul>
</li>
<li>
<em>species-coded-in-db-ref.csv</em>
<ul>
<li>This is a list of all the species data from the database that have
been filtered where <strong>organism_habitat</strong> is “Water”.</li>
<li>This file is to help find which <strong>class</strong> and
<strong>tax_order</strong> (order) do not have coding for the ecological
or trophic groups.</li>
<li>This file is for reference and not to be updated or sent back for
integration.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="life-stage-codes">Life Stage Codes<a class="anchor" aria-label="anchor" href="#life-stage-codes"></a>
</h4>
<p>This data set should be reviewed each time a new version of the
ECOTOX database is released.</p>
<p>This data set will be sent separately after the first round of files
is reviewed because this data depends on the updates to the trophic
group data. Only fish and amphibian groups need the life stage
categorized into simple groups, so this file only contains fish and
amphibians.</p>
<p><em>lifestage-code-review.csv</em>: - If there is no value in the
<strong>simple_lifestage</strong> column this indicates it is a new life
stage that was not in the previous coding of the database. - The goal of
the review is to ensure all cells in the
<strong>simple_lifestage</strong> are filled in. - In the
<strong>simple_lifestage</strong> column fill in any empty cells with
either <code>els</code> (early life stage), <code>juvenile</code> or
<code>adult</code>.</p>
<p>Once completed, this file should be saved in the
<code>"completed"</code> subfolder in the review folder.</p>
</div>
<div class="section level4">
<h4 id="bc-species">BC Species<a class="anchor" aria-label="anchor" href="#bc-species"></a>
</h4>
<p>This reference dataset has not been included in the
<em>review-reference-datasets.R</em> script as it should not vary from
year to year.</p>
<p>This data set is a comprehensive list that was generated from B.C.
Conservation Data Centre.</p>
<p>Any species that is not listed in the <em>bc-species.csv</em>
reference file is marked as not present in BC and thus it is robust to
new species added to the ECOTOX dataset.</p>
</div>
<div class="section level4">
<h4 id="concentration-endpoints">Concentration Endpoints<a class="anchor" aria-label="anchor" href="#concentration-endpoints"></a>
</h4>
<p>This reference dataset has not been included in the
<em>review-reference-datasets.R</em> script as it should not vary from
year to year.</p>
<p>There is a comprehensive list that should not need to be
adjusted.</p>
<p>The list of concentration endpoints are generated in the
<em>scripts/concentration-endpoints.R</em> script.</p>
<p>If updates are required then update the
<em>concentration-endpoints.R</em> script.</p>
</div>
</div>
<div class="section level3">
<h3 id="updating-the-add-data-template">Updating the Add Data Template<a class="anchor" aria-label="anchor" href="#updating-the-add-data-template"></a>
</h3>
<p><strong>This will rarely need to be done as additions / removals to
ecological groups and trophic groups are uncommon</strong></p>
<div class="section level4">
<h4 id="associated-reference-data">Associated Reference Data<a class="anchor" aria-label="anchor" href="#associated-reference-data"></a>
</h4>
<p>The instructions in the upload data template need to be updated when
changes to the reference data sheets occur.</p>
<ul>
<li>
<em>trophic-groups.csv</em>
<ul>
<li>Update <strong>trophic_group</strong> and
<strong>ecological_group</strong> column instructions if new groups are
added or groups are removed.
<ul>
<li>ie if <code>Plant</code> is removed as a trophic group or
<code>Salmonid</code> is removed as an ecological group.</li>
<li>Since the groups (Plant, Bacteria, Amphibian, etc) have been written
into the instruction tab this is why updates to the instructions are
needed if new categories are added.</li>
</ul>
</li>
<li>The validation of the values is done from the
<em>trophic-groups.csv</em> which means it is possible for the
instructions to get out of sync with the allowed values.</li>
<li>Adding new species to the <em>trophic-groups.csv</em> does not
trigger a change to the instructions.</li>
</ul>
</li>
<li>
<em>lifestage-codes.csv</em>
<ul>
<li>Update <strong>simple_lifestage</strong> column instructions if new
simple life stages categories are added or removed.
<ul>
<li>ie if <code>els</code> is removed as a simple life stage.</li>
</ul>
</li>
<li>The validation is done off the <em>lifestage-codes.csv</em> which
means it is possible for the instructions to get out of sync with the
allowed values.</li>
</ul>
</li>
<li>
<em>concentration-endpoints.csv</em>
<ul>
<li>Update <strong>endpoint</strong> column instructions if endpoints
are added or removed.</li>
<li>The list of endpoints are generated by the script
<em>scripts/concentration-endpoints.R</em>.</li>
<li>The validation is done off of the
<em>concentration-endpoints.csv</em> so it is possible for the
instructions to get out of sync with the allowed values.</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="to-update-the-template">To update the template<a class="anchor" aria-label="anchor" href="#to-update-the-template"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Make any required changes to the trophic groups, life stage codes or
concentration endpoints reference data.</li>
<li>Edit the <em>inst/template/template-data-data.csv</em> and
<em>inst/template/template-data-instructions.csv</em> files.
<ul>
<li>Do not edit the file <em>inst/template/template-data.xlsx</em>.</li>
</ul>
</li>
<li>To regenerate the template run the script
<em>data-raw/template.R</em>.</li>
<li>Review the <em>inst/template/template-data.xlsx</em> to confirm the
edits came through and the template looks as expected.
<ul>
<li>Do not edit the file <em>inst/template/template-data.xlsx</em>.</li>
</ul>
</li>
</ol>
</div>
</div>
</div>
<div class="section level2">
<h2 id="push-and-install-the-pacakge">Push and install the pacakge<a class="anchor" aria-label="anchor" href="#push-and-install-the-pacakge"></a>
</h2>
<p>Finally, after all of the all of the updates are completed, push them
to GitHub. Install the updated package with
<code>devtools::install()</code>, or from GitHub with
<code>devtools::install_github("bcgov/wqbench")</code>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ayla Pearson, Angeline Tillmanns.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
